<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHARAOH'S FORTUNE - ItemGame</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/slot.css">
</head>
<body class="slot-page">
    <!-- Ìó§Îçî -->
    <header class="header">
        <div class="header-logo" onclick="location.href='index.html'" style="cursor:pointer">ITEM<span>GAME</span></div>
        <div class="header-chips">
            <div class="chip-icon">$</div>
            <div class="chip-balance" id="headerChips">0</div>
        </div>
        <nav class="header-nav">
            <button class="nav-btn" onclick="location.href='index.html'">LOBBY</button>
            <button class="sound-toggle" id="soundToggleBtn" onclick="SoundManager.toggleMute()" title="ÏÜåÎ¶¨ ÎÅÑÍ∏∞">üîä</button>
        </nav>
    </header>

    <!-- Î©îÏù∏ -->
    <main class="container">
        <div class="slot-container">
            <!-- Í≤åÏûÑ ÌÉÄÏù¥ÌãÄ -->
            <div class="game-title-area">
                <div class="game-title">PHARAOH'S FORTUNE</div>
                <div class="game-subtitle">9 Lines | RTP ~96%</div>
            </div>

            <!-- ÌîÑÎ¶¨Ïä§ÌïÄ Ïπ¥Ïö¥ÌÑ∞ (Í∏∞Î≥∏ Ïà®ÍπÄ) -->
            <div class="free-spin-counter" id="freeSpinCounter" style="display:none">
                <span class="fs-label">FREE SPINS</span>
                <span class="fs-count">0</span>
            </div>

            <!-- Î©ÄÌã∞ÌîåÎùºÏù¥Ïñ¥ (Í∏∞Î≥∏ Ïà®ÍπÄ) -->
            <div class="multiplier-display" id="multiplierDisplay" style="display:none">
                <span class="mult-label">MULTIPLIER</span>
                <span class="mult-value">x1</span>
            </div>

            <!-- Ïä¨Î°ØÎ®∏Ïã† -->
            <div class="slot-machine">
                <!-- Î¶¥ ÏòÅÏó≠ -->
                <div class="reels-container">
                    <div class="reels-grid">
                        <!-- JSÎ°ú ÏÉùÏÑ± -->
                    </div>
                </div>

                <!-- Í≤∞Í≥º ÌëúÏãú -->
                <div class="result-display" id="slotResult">SPIN TO BEGIN</div>

                <!-- Í≤åÏûÑ ÌÜµÍ≥Ñ -->
                <div class="game-stats" id="gameStats">
                    <span>SPINS: 0</span>
                    <span>WINS: 0</span>
                    <span>BEST: 0</span>
                </div>
            </div>

            <!-- ÌïòÎã® Ïª®Ìä∏Î°§ Î∞î -->
            <div class="control-bar">
                <!-- Î≤†ÌåÖ ÏòÅÏó≠ -->
                <div class="bet-section">
                    <div class="bet-controls">
                        <button class="bet-btn" onclick="SlotMachine.decreaseBet()">‚àí</button>
                        <div class="bet-display">
                            <span class="bet-label">BET</span>
                            <span class="bet-amount" id="betAmount">100</span>
                        </div>
                        <button class="bet-btn" onclick="SlotMachine.increaseBet()">+</button>
                    </div>
                    <div class="quick-bet-buttons">
                        <button class="quick-bet" data-bet="10" onclick="SlotMachine.setBet(10)">10</button>
                        <button class="quick-bet" data-bet="50" onclick="SlotMachine.setBet(50)">50</button>
                        <button class="quick-bet active" data-bet="100" onclick="SlotMachine.setBet(100)">100</button>
                        <button class="quick-bet" data-bet="500" onclick="SlotMachine.setBet(500)">500</button>
                        <button class="quick-bet" data-bet="1000" onclick="SlotMachine.setBet(1000)">MAX</button>
                    </div>
                </div>

                <!-- Ïä§ÌïÄ Î≤ÑÌäº -->
                <button class="spin-button" id="spinButton" onclick="SlotMachine.spin()">SPIN</button>

                <!-- Ïò§ÌÜ† Ïä§ÌïÄ -->
                <div class="auto-section">
                    <button class="auto-spin-toggle" id="autoSpinBtn" onclick="SlotMachine.toggleAutoSpin()">üîÑ AUTO</button>
                </div>
            </div>

            <!-- Í∞¨Î∏î(ÎçîÎ∏îÏóÖ) Ìå®ÎÑê -->
            <div class="gamble-panel" id="gamblePanel" style="display:none">
                <div class="gamble-header">
                    DOUBLE UP? <span class="gamble-amount">0</span> CHIPS
                </div>
                <div class="gamble-card-area">
                    <div class="gamble-card" id="gambleCard">?</div>
                </div>
                <div class="gamble-buttons">
                    <button class="gamble-btn gamble-red" onclick="SlotMachine.gambleDouble('red')">
                        ‚ô• RED
                    </button>
                    <button class="gamble-btn gamble-black" onclick="SlotMachine.gambleDouble('black')">
                        ‚ô† BLACK
                    </button>
                    <button class="gamble-btn gamble-collect" onclick="SlotMachine.gambleCollect()">
                        COLLECT
                    </button>
                </div>
            </div>

            <!-- ÌéòÏù¥ÌÖåÏù¥Î∏î -->
            <div class="paytable">
                <h3 class="paytable-title">PAYTABLE</h3>
                <div class="paytable-special">
                    <div class="paytable-special-item">
                        <span class="paytable-symbol wild-badge">‚≠ê WILD</span>
                        <span class="paytable-desc">Substitutes all symbols except Scatter</span>
                    </div>
                    <div class="paytable-special-item">
                        <span class="paytable-symbol scatter-badge">üìú SCATTER</span>
                        <span class="paytable-desc">3+ anywhere triggers FREE SPINS (10/15/25)</span>
                    </div>
                </div>
                <div class="paytable-grid" id="paytableGrid">
                    <!-- JSÎ°ú ÏÉùÏÑ± -->
                </div>
                <p class="paytable-footer">
                    9 PAYLINES | 3+ CONSECUTIVE MATCH | WILD SUBSTITUTES | SCATTER FREE SPINS
                </p>
            </div>
        </div>
    </main>

    <!-- ÌîÑÎ¶¨Ïä§ÌïÄ Î∞∞ÎÑà Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="free-spin-banner" id="freeSpinBanner">
        <div class="fs-text">FREE SPINS!</div>
    </div>

    <!-- ÏäπÎ¶¨ Ïò§Î≤ÑÎ†àÏù¥ (5Îã®Í≥Ñ) -->
    <div class="win-overlay" id="winOverlay">
        <div class="win-content">
            <div class="win-tier-text">WIN!</div>
            <div class="win-amount">+0</div>
        </div>
    </div>

    <!-- ÌÜ†Ïä§Ìä∏ -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="js/core/firebase-config.js"></script>
    <script src="js/core/chip-manager.js"></script>
    <script src="js/core/sound-manager.js"></script>
    <script src="js/games/slot-machine.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            ChipManager.init();
            SoundManager.init();
            ChipManager.onBalanceChange(() => {
                document.getElementById('headerChips').textContent = ChipManager.formatBalance();
            });
            document.getElementById('headerChips').textContent = ChipManager.formatBalance();

            SlotMachine.init();
            _buildPaytable();
        });

        // ÌéòÏù¥ÌÖåÏù¥Î∏î ÏÉùÏÑ±
        function _buildPaytable() {
            const grid = document.getElementById('paytableGrid');
            if (!grid) return;
            grid.innerHTML = '';

            SlotMachine.SYMBOLS.forEach(sym => {
                if (sym.type === 'wild' || sym.type === 'scatter') return; // Ïù¥ÎØ∏ ÌäπÎ≥Ñ ÏÑπÏÖòÏóê ÌëúÏãú
                const item = document.createElement('div');
                item.className = 'paytable-item';
                const emojiHtml = sym.cls === 'sym-card'
                    ? `<span class="pt-card-letter">${sym.emoji}</span>`
                    : `<span class="pt-emoji">${sym.emoji}</span>`;
                item.innerHTML = `
                    ${emojiHtml}
                    <span class="paytable-info">
                        <span class="pt-name">${sym.name}</span>
                        <span class="pt-pays">
                            <span class="multiplier">x${sym.pay[0]}</span>
                            <span class="multiplier">x${sym.pay[1]}</span>
                            <span class="multiplier">x${sym.pay[2]}</span>
                        </span>
                    </span>
                `;
                grid.appendChild(item);
            });
        }

        // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !SlotMachine.getIsSpinning()) {
                e.preventDefault();
                SlotMachine.spin();
            }
        });
    </script>
</body>
</html>
