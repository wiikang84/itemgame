<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUCKY JACKPOT - ItemGame</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/slot.css">
</head>
<body class="slot-page">
    <!-- v5.0: Ïä§Ìè¨Ìä∏ÎùºÏù¥Ìä∏ ÌöåÏ†Ñ Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="spotlight-overlay"></div>

    <!-- Ìó§Îçî -->
    <header class="header">
        <div class="header-logo" onclick="location.href='index.html'" style="cursor:pointer">ITEM<span>GAME</span></div>
        <div class="header-center">
            <div class="header-chips">
                <div class="chip-icon">$</div>
                <div class="chip-balance" id="headerChips">0</div>
            </div>
            <div class="level-badge">
                <span class="level-text" id="levelDisplay">Lv.1</span>
                <div class="xp-bar"><div class="xp-bar-fill" id="xpBarFill"></div></div>
                <span class="xp-text" id="xpText">0/500</span>
            </div>
        </div>
        <nav class="header-nav">
            <button class="nav-btn" onclick="location.href='index.html'">Î°úÎπÑ</button>
            <button class="sound-toggle" id="soundToggleBtn" onclick="SoundManager.toggleMute()" title="ÏÜåÎ¶¨ ÎÅÑÍ∏∞">üîä</button>
        </nav>
    </header>

    <!-- Î©îÏù∏ -->
    <main class="container">
        <div class="slot-cabinet">

            <!-- ‚ïê‚ïê‚ïê ÌÉë Î∞ïÏä§ (ÌÉÄÏù¥ÌãÄ + Ïû≠Ìåü) ‚ïê‚ïê‚ïê -->
            <div class="cabinet-top">
                <!-- v5.1: LED Ïä§Ìä∏Î¶Ω (10Í∞ú Í∏à+Îπ®Í∞ï ÍµêÏ∞® Ï≤¥Ïù¥Ïä§ Ïï†ÎãàÎ©îÏù¥ÏÖò) -->
                <div class="led-strip">
                    <span class="led-dot led-gold"></span>
                    <span class="led-dot led-red"></span>
                    <span class="led-dot led-gold"></span>
                    <span class="led-dot led-red"></span>
                    <span class="led-dot led-gold"></span>
                    <span class="led-dot led-red"></span>
                    <span class="led-dot led-gold"></span>
                    <span class="led-dot led-red"></span>
                    <span class="led-dot led-gold"></span>
                    <span class="led-dot led-red"></span>
                </div>
                <!-- v5.1: Ïû•Ïãù ÏöîÏÜå (Î≥Ñ/Îã§Ïù¥ÏïÑ/ÌÅ¨ÎùºÏö¥) -->
                <div class="cabinet-decorations">
                    <span class="deco-star left">‚òÖ</span>
                    <span class="deco-diamond left-inner">‚óÜ</span>
                    <span class="deco-crown">‚ôõ</span>
                    <span class="deco-diamond right-inner">‚óÜ</span>
                    <span class="deco-star right">‚òÖ</span>
                </div>
                <div class="cabinet-corner-light left"></div>
                <div class="cabinet-corner-light right"></div>
                <!-- v4.0: <div class="game-title">LUCKY SEVENS</div> -->
                <div class="game-title">JACKPOT</div>
                <!-- v4.0: <div class="game-subtitle">9 Lines &bull; RTP ~96%</div> -->
                <div class="game-subtitle">LUCKY JACKPOT &bull; YOUR LUCK HERE</div>
                <!-- v5.0: ÌïòÎã® Í≥®Îìú ÎùºÏù∏ -->
                <div class="gold-line-bottom"></div>
            </div>

            <!-- ‚ïê‚ïê‚ïê ÌîÑÎ¶¨Ïä§ÌïÄ / Î©ÄÌã∞ÌîåÎùºÏù¥Ïñ¥ ‚ïê‚ïê‚ïê -->
            <div class="free-spin-counter" id="freeSpinCounter" style="display:none">
                <span class="fs-label">Î¨¥Î£å Ïä§ÌïÄ</span>
                <span class="fs-count">0</span>
            </div>
            <div class="multiplier-display" id="multiplierDisplay" style="display:none">
                <span class="mult-label">Î∞∞Ïú®</span>
                <span class="mult-value">x1</span>
            </div>

            <!-- ‚ïê‚ïê‚ïê Î¶¥ ÌîÑÎ†àÏûÑ (Ï∫êÎπÑÎãõ Î©îÏù∏ Î∞îÎîî) ‚ïê‚ïê‚ïê -->
            <div class="reels-frame">
                <div class="reels-container" id="reelsContainer">
                    <div class="reels-grid" id="reelsGrid">
                        <!-- JS ÏÉùÏÑ± -->
                    </div>
                    <!-- ÎπÑÎÑ§Ìä∏ Ïò§Î≤ÑÎ†àÏù¥ -->
                    <div class="reel-vignette"></div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê Ïù∏Ìè¨ Î∞î (LED ÎîîÏä§ÌîåÎ†àÏù¥) ‚ïê‚ïê‚ïê -->
            <div class="info-bar">
                <div class="info-cell">
                    <span class="info-label">ÌÅ¨Î†àÎîß</span>
                    <span class="info-value led-display" id="creditDisplay">0</span>
                </div>
                <div class="info-cell result-cell">
                    <span class="info-value result-text" id="slotResult">Ïä§ÌïÄÌïòÏÑ∏Ïöî</span>
                </div>
                <div class="info-cell">
                    <span class="info-label">ÎãπÏ≤®</span>
                    <span class="info-value led-display" id="winDisplay">0</span>
                </div>
            </div>

            <!-- Í≤åÏûÑ ÌÜµÍ≥Ñ -->
            <div class="game-stats" id="gameStats">
                <span>Ïä§ÌïÄ: 0</span>
                <span>ÎãπÏ≤®: 0</span>
                <span>ÏµúÍ≥†: 0</span>
            </div>

            <!-- ‚ïê‚ïê‚ïê Ï∫êÎπÑÎãõ Î≤®Î¶¨ (Ïª®Ìä∏Î°§ ÏòÅÏó≠) ‚ïê‚ïê‚ïê -->
            <div class="cabinet-belly">
                <!-- Î≤†ÌåÖ Ï†ïÎ≥¥ Î∞î -->
                <div class="bet-info-bar">
                    <div class="bet-info-item">
                        <span class="bet-info-label">Î≤†ÌåÖ</span>
                        <span class="bet-info-value led-small" id="betAmount">100</span>
                    </div>
                    <div class="bet-info-item">
                        <span class="bet-info-label">ÎùºÏù∏</span>
                        <span class="bet-info-value led-small">9</span>
                    </div>
                    <div class="bet-info-item">
                        <span class="bet-info-label">Ï¥ù Î≤†ÌåÖ</span>
                        <span class="bet-info-value led-small" id="totalBet">100</span>
                    </div>
                </div>

                <!-- v5.0: Ï∫êÎπÑÎãõ Î≤ÑÌäº Î∞î (ÏÇºÎ∂ÑÌï† Î†àÏù¥ÏïÑÏõÉ) -->
                <div class="cabinet-button-bar">
                    <!-- Ï¢å: Î≤†ÌåÖ Ïª®Ìä∏Î°§ -->
                    <div class="btn-group btn-group-left">
                        <button class="cab-btn cab-btn-info" onclick="togglePaytable()" title="Î∞∞ÎãπÌëú">
                            <span class="cab-btn-icon">i</span>
                            <span class="cab-btn-label">Î∞∞Îãπ</span>
                        </button>
                        <button class="cab-btn cab-btn-bet" onclick="SlotMachine.decreaseBet()">
                            <span class="cab-btn-icon">&minus;</span>
                            <span class="cab-btn-label">Î≤†ÌåÖ</span>
                        </button>
                        <button class="cab-btn cab-btn-bet" onclick="SlotMachine.increaseBet()">
                            <span class="cab-btn-icon">+</span>
                            <span class="cab-btn-label">Î≤†ÌåÖ</span>
                        </button>
                    </div>
                    <!-- Ï§ë: SPIN + MAX + AUTO -->
                    <div class="btn-group btn-group-center">
                        <button class="cab-btn cab-btn-maxbet" onclick="SlotMachine.setBet(1000)">
                            <span class="cab-btn-label">ÏµúÎåÄ<br>Î≤†ÌåÖ</span>
                        </button>
                        <button class="cab-btn cab-btn-spin" id="spinButton" onclick="SlotMachine.spin()">
                            <span class="cab-btn-label">Ïä§ÌïÄ</span>
                        </button>
                        <!-- Ïò§ÌÜ†Ïä§ÌïÄ: Î≤ÑÌäº + ÏòµÏÖò Î©îÎâ¥ -->
                        <div class="auto-spin-wrapper">
                            <button class="cab-btn cab-btn-auto" id="autoSpinBtn" onclick="SlotMachine.toggleAutoSpin()">
                                <span class="cab-btn-label">ÏûêÎèô</span>
                            </button>
                            <div class="auto-spin-menu" id="autoSpinMenu" style="display:none">
                                <div class="auto-menu-title">ÏûêÎèô Ïä§ÌïÄ ÌöüÏàò</div>
                                <button class="auto-menu-item" onclick="SlotMachine.startAutoSpin(10)">10Ìöå</button>
                                <button class="auto-menu-item" onclick="SlotMachine.startAutoSpin(25)">25Ìöå</button>
                                <button class="auto-menu-item" onclick="SlotMachine.startAutoSpin(50)">50Ìöå</button>
                                <button class="auto-menu-item" onclick="SlotMachine.startAutoSpin(100)">100Ìöå</button>
                                <button class="auto-menu-item" onclick="SlotMachine.startAutoSpin(-1)">Î¨¥Ï†úÌïú</button>
                            </div>
                        </div>
                    </div>
                    <!-- Ïö∞: LINES ÎîîÏä§ÌîåÎ†àÏù¥ -->
                    <div class="btn-group btn-group-right">
                        <div class="lines-display">
                            <span class="lines-label">LINES</span>
                            <span class="lines-value">9</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê Í∞¨Î∏î(ÎçîÎ∏îÏóÖ) Ìå®ÎÑê ‚ïê‚ïê‚ïê -->
            <div class="gamble-panel" id="gamblePanel" style="display:none">
                <div class="gamble-header">
                    ÎçîÎ∏îÏóÖ! <span class="gamble-amount">0</span> Ïπ©
                </div>
                <div class="gamble-hint">Ïπ¥Îìú ÏÉâÏÉÅÏùÑ ÎßûÏ∂îÎ©¥ ÎãπÏ≤®Í∏à 2Î∞∞!</div>
                <div class="gamble-card-area">
                    <div class="gamble-card" id="gambleCard">?</div>
                </div>
                <div class="gamble-buttons">
                    <button class="gamble-btn gamble-red" onclick="SlotMachine.gambleDouble('red')">&#9829; Îπ®Í∞ï</button>
                    <button class="gamble-btn gamble-black" onclick="SlotMachine.gambleDouble('black')">&#9824; Í≤ÄÏ†ï</button>
                    <button class="gamble-btn gamble-collect" onclick="SlotMachine.gambleCollect()">Î∞õÍ∏∞</button>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê Î∞∞ÎãπÌëú (Í∏∞Î≥∏ Ïà®ÍπÄ, Î∞∞Îãπ Î≤ÑÌäºÏúºÎ°ú ÌÜ†Í∏Ä) ‚ïê‚ïê‚ïê -->
            <div class="paytable" id="paytableSection" style="display:none">
                <h3 class="paytable-title">Î∞∞ÎãπÌëú</h3>
                <div class="paytable-special">
                    <div class="paytable-special-item">
                        <span class="paytable-symbol wild-badge">WILD</span>
                        <span class="paytable-desc">Î≥¥ÎÑàÏä§ Ï†úÏô∏ Î™®Îì† Ïã¨Î≥ºÏùÑ ÎåÄÏ≤¥Ìï©ÎãàÎã§</span>
                    </div>
                    <div class="paytable-special-item">
                        <span class="paytable-symbol scatter-badge">BONUS</span>
                        <span class="paytable-desc">3Í∞ú Ïù¥ÏÉÅ Ï∂úÌòÑ Ïãú Î¨¥Î£åÏä§ÌïÄ (10/15/25Ìöå)</span>
                    </div>
                </div>
                <div class="paytable-grid" id="paytableGrid">
                    <!-- JS ÏÉùÏÑ± -->
                </div>
                <p class="paytable-footer">
                    9 ÌéòÏù¥ÎùºÏù∏ &bull; 3Í∞ú+ Ïó∞ÏÜç Îß§Ïπò &bull; WILD ÎåÄÏ≤¥ &bull; BONUS Î¨¥Î£åÏä§ÌïÄ
                </p>
            </div>

        </div>
    </main>

    <!-- ‚ïê‚ïê‚ïê Ïò§Î≤ÑÎ†àÏù¥ ‚ïê‚ïê‚ïê -->
    <div class="free-spin-banner" id="freeSpinBanner">
        <div class="fs-text">Î¨¥Î£å Ïä§ÌïÄ!</div>
    </div>

    <div class="win-overlay" id="winOverlay">
        <div class="win-content">
            <div class="win-tier-text">ÎãπÏ≤®!</div>
            <div class="win-amount">+0</div>
        </div>
    </div>

    <!-- ÏΩîÏù∏ ÏÉ§Ïõå Ï∫îÎ≤ÑÏä§ -->
    <canvas id="coinShowerCanvas"></canvas>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Î†àÎ≤®ÏóÖ Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="levelup-overlay" id="levelupOverlay">
        <div class="levelup-content">
            <div class="levelup-title" id="levelupTitle">LEVEL UP!</div>
            <div class="levelup-bonus" id="levelupBonus">+0 Ïπ©</div>
        </div>
    </div>

    <!-- ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò (Î™®Î∞îÏùº) -->
    <nav class="bottom-nav">
        <div class="bottom-nav-inner">
            <a href="index.html" class="bottom-nav-item">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Ìôà</span>
            </a>
            <a href="index.html#dailyBonusBanner" class="bottom-nav-item">
                <span class="nav-icon">üéÅ</span>
                <span class="nav-label">Î≥¥ÎÑàÏä§</span>
            </a>
            <button class="bottom-nav-item" onclick="SoundManager.toggleMute()">
                <span class="nav-icon">üîä</span>
                <span class="nav-label">ÏÇ¨Ïö¥Îìú</span>
            </button>
        </div>
    </nav>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script src="js/core/firebase-config.js"></script>
    <script src="js/core/chip-manager.js"></script>
    <script src="js/core/sound-manager.js"></script>
    <script src="js/core/coin-shower.js"></script>
    <script src="js/core/level-manager.js"></script>
    <script src="js/core/neon-particles.js"></script>
    <script src="js/games/slot-machine.js"></script>
    <script>
        // ÌéòÏù¥ÌÖåÏù¥Î∏î ÌÜ†Í∏Ä
        let _paytableVisible = false;
        function togglePaytable() {
            const section = document.getElementById('paytableSection');
            if (!section) return;
            _paytableVisible = !_paytableVisible;
            section.style.display = _paytableVisible ? 'block' : 'none';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await ChipManager.init();
            SoundManager.init();
            CoinShower.init();
            LevelManager.init();
            NeonParticles.init();

            ChipManager.onBalanceChange(() => {
                document.getElementById('headerChips').textContent = ChipManager.formatBalance();
                document.getElementById('creditDisplay').textContent = ChipManager.getBalance().toLocaleString();
            });
            document.getElementById('headerChips').textContent = ChipManager.formatBalance();
            document.getElementById('creditDisplay').textContent = ChipManager.getBalance().toLocaleString();

            // Î†àÎ≤®ÏóÖ Î¶¨Ïä§ÎÑà
            LevelManager.onEvent((event) => {
                if (event.type === 'levelup') {
                    const overlay = document.getElementById('levelupOverlay');
                    if (overlay) {
                        document.getElementById('levelupTitle').textContent = `LEVEL ${event.level}!`;
                        document.getElementById('levelupBonus').textContent = `+${event.bonus.toLocaleString()} Î≥¥ÎÑàÏä§ Ïπ©`;
                        overlay.classList.add('active');
                        setTimeout(() => overlay.classList.remove('active'), 3000);
                    }
                }
            });

            SlotMachine.init();
            _buildPaytable();
        });

        // ÌéòÏù¥ÌÖåÏù¥Î∏î ÏÉùÏÑ±
        function _buildPaytable() {
            const grid = document.getElementById('paytableGrid');
            if (!grid) return;
            grid.innerHTML = '';
            SlotMachine.SYMBOLS.forEach(sym => {
                if (sym.type === 'wild' || sym.type === 'scatter') return;
                const item = document.createElement('div');
                item.className = 'paytable-item';
                item.innerHTML = `
                    <span class="pt-symbol">${sym.label || sym.name}</span>
                    <span class="paytable-info">
                        <span class="pt-name">${sym.name}</span>
                        <span class="pt-pays">
                            <span class="multiplier">x${sym.pay[0]}</span>
                            <span class="multiplier">x${sym.pay[1]}</span>
                            <span class="multiplier">x${sym.pay[2]}</span>
                        </span>
                    </span>
                `;
                grid.appendChild(item);
            });
        }

        // ÌÇ§Î≥¥Îìú: Space=Ïä§ÌïÄ, Space Ï§ë Ïä§ÌïÄ=ÌÄµÏä§ÌÜ±
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                SlotMachine.spin();
            }
        });
    </script>
</body>
</html>
